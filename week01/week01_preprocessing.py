# =============================================================================
# Week 01. 데이터 전처리 (Preprocessing)
# =============================================================================
# Dataset: Student Performance and Learning Behavior Dataset
# Original Source: https://zenodo.org/records/16459132
# Original License: CC BY 4.0 (https://creativecommons.org/licenses/by/4.0/)
# Original Creator: Kamal Najem (Mohammed V University)
# Changes: 한글 변수명 변환, 일부 변수 삭제 및 재코딩 적용
# =============================================================================

# -----------------------------------------------------------------------------
# 0. 라이브러리 및 데이터 불러오기
# -----------------------------------------------------------------------------
import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler, LabelEncoder, OneHotEncoder

url = "https://raw.githubusercontent.com/SJ-EduLab/ML-for-Education/main/week01/student_learning_data_kr.csv"
df = pd.read_csv(url)

print(f"데이터 크기: {df.shape[0]}행 × {df.shape[1]}열")
df.head()

# -----------------------------------------------------------------------------
# 1. 데이터 탐색
# -----------------------------------------------------------------------------

# 1-1. 변수 타입 확인
df.info()

# 1-2. 결측치 확인
df.isnull().sum()

# 1-3. 기술통계
df.describe()

# 1-4. 범주형 변수 고유값 확인
for col in df.select_dtypes(include='object').columns:
    print(f"\n[{col}]")
    print(df[col].value_counts())

# -----------------------------------------------------------------------------
# 2. 변수 유형 분류
# -----------------------------------------------------------------------------
# 분석에 앞서 각 변수의 특성에 따라 유형을 나눕니다.
# 이 분류가 이후 인코딩과 스케일링 방식을 결정합니다.

# 연속형: 숫자 자체에 크기·간격 의미가 있는 변수
continuous = ['주당학습시간', '출석률', '나이', '온라인강좌수', '과제완료율', '시험점수']

# 서열형: 순서에 의미가 있는 범주 (낮음 < 보통 < 높음)
ordinal = ['학습동기', '스트레스수준']

# 이진형: 두 가지 값만 존재하는 변수
binary = ['비교과활동', '인터넷접근', '성별', '토론참여']

# 명목형: 범주 간 순서가 없는 변수 (VARK 학습유형)
nominal = ['선호학습유형']

# 타겟: 예측 대상 (A > B > C > D)
target = '최종성적'

# -----------------------------------------------------------------------------
# 3. 서열형 변수 인코딩
# -----------------------------------------------------------------------------
# '낮음', '보통', '높음'처럼 순서가 있는 범주는
# 그 순서를 반영하는 숫자로 변환합니다.

ordinal_map = {'낮음': 0, '보통': 1, '높음': 2}

for col in ordinal:
    df[col] = df[col].map(ordinal_map)

print("서열형 인코딩 완료:")
print(df[ordinal].head())

# -----------------------------------------------------------------------------
# 4. 이진형 변수 인코딩
# -----------------------------------------------------------------------------
# 두 가지 값만 있는 변수는 0과 1로 변환합니다.

binary_map = {
    '비교과활동': {'미참여': 0, '참여': 1},
    '인터넷접근': {'없음': 0, '있음': 1},
    '성별':       {'여': 0, '남': 1},
    '토론참여':   {'미참여': 0, '참여': 1},
}

for col, mapping in binary_map.items():
    df[col] = df[col].map(mapping)

print("이진형 인코딩 완료:")
print(df[binary].head())

# -----------------------------------------------------------------------------
# 5. 명목형 변수 인코딩 (원핫인코딩)
# -----------------------------------------------------------------------------
# 선호학습유형은 청각형·운동감각형·읽기쓰기형·시각형의 4개 범주입니다.
# 범주 간 순서가 없으므로, 각 범주를 독립 열로 분리합니다.
#
# 왜 원핫인코딩인가?
#   숫자(0,1,2,3)로 바꾸면 모델이 '시각형(3) > 청각형(0)'처럼
#   존재하지 않는 크기 관계를 학습할 수 있기 때문입니다.

df = pd.get_dummies(df, columns=nominal, prefix='학습유형')

# 생성된 열 확인
style_cols = [c for c in df.columns if c.startswith('학습유형_')]
print(f"원핫인코딩 결과: {style_cols}")
print(df[style_cols].head())

# -----------------------------------------------------------------------------
# 6. 타겟 변수 인코딩
# -----------------------------------------------------------------------------
# 최종성적(A/B/C/D)을 숫자로 변환합니다.
# 높은 숫자 = 좋은 성적이 되도록 코딩합니다.

grade_map = {'D': 0, 'C': 1, 'B': 2, 'A': 3}
df[target] = df[target].map(grade_map)

print("타겟 인코딩 완료:")
print(df[target].value_counts().sort_index())

# -----------------------------------------------------------------------------
# 7. 연속형 변수 스케일링
# -----------------------------------------------------------------------------
# 연속형 변수들은 범위가 서로 다릅니다.
#   - 주당학습시간: 5 ~ 44
#   - 출석률:       60 ~ 100
#   - 나이:         18 ~ 29
#
# StandardScaler를 적용하면 모든 변수가 평균 0, 표준편차 1로 통일되어
# 특정 변수가 모델에 과도한 영향을 미치는 것을 방지합니다.

scaler = StandardScaler()
df[continuous] = scaler.fit_transform(df[continuous])

print("스케일링 완료:")
print(df[continuous].describe().round(2))

# -----------------------------------------------------------------------------
# 8. X, y 분리
# -----------------------------------------------------------------------------

y = df[target]
X = df.drop(columns=[target])

print(f"\nX shape: {X.shape}")
print(f"y shape: {y.shape}")
print(f"y 분포:\n{y.value_counts().sort_index()}")

# -----------------------------------------------------------------------------
# 9. 전처리 결과 확인
# -----------------------------------------------------------------------------

print("\n전처리 완료된 데이터:")
X.head()
